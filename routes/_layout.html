<Nav page={child.props.path.slice(1) || 'home'} />

<div class="container" tabindex="0" ref:container >
  <main>
    <svelte:component this={child.component} {...child.props} />
  </main>
  {#if !$isUserLoggedIn && (child.props.path.slice(1) || 'home') === 'home'}
    <InformationalFooter />
  {/if}
</div>

<script>
  import { store } from './_store/store'
  import { observe } from 'svelte-extras'

  export default {
    components: {
      Nav: './_components/Nav.html',
      InformationalFooter: './_components/InformationalFooter.html'
    },
    oncreate () {
      // Only focus the `.container` div on first load so it does not intefere
      // with other desired behaviours (e.g. you click a toot, you navigate from
      // a timeline view to a thread view, you press the back button, and now
      // you're still focused on the toot).
      this.refs.container.focus()

      if (process.browser && process.env.NODE_ENV !== 'production') {
        window.layoutObject = this
      }

      this.observe('child', child => {
        // TODO: sapper has a bug apparently, can't use computed properties for this
        this.store.set({currentPage: (child.props.path.slice(1) || 'home')})
      })
    },
    store: () => store,
    methods: {
      observe
    }
  }
</script>
